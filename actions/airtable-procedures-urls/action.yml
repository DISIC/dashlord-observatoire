name: "Get Airtable procedures URLs to scan"
description: "Rapatrier les URLs des démarches via Airtable pour préparer le scan"

inputs:
  airtable_api_key:
    description: "Clé API Airtable"
    required: true
  airtable_base_id:
    description: "Identifiant de la base Airtable"
    required: true
  airtable_table_name:
    description: "Nom de la table Airtable"
    required: true
  output:
    description: "Path to output file. defaults to airtable-procedures_urls.json"
    default: "airtable-procedures_urls.json"
    required: true

runs:
  using: "composite"
  steps:
    - name: Install
      shell: bash
      run: |
        cd ${{ github.action_path }}
        yarn
    - name: Get Airtable procedures URLs and IDs
      shell: bash
      run: |
        cd ${{ github.action_path }}
        node index ${{ inputs.airtable_api_key }} ${{ inputs.airtable_base_id }} ${{ inputs.airtable_table_name }} > ${{ inputs.output }}
        STRING_URLS=$(cat ${{ inputs.output }} | python3 -c "import sys, json; data = json.load(sys.stdin); print(','.join(list(map(lambda d : d['link'], data))));")
        echo "::set-output name=urls::$STRING_URLS"
